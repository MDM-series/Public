---
title: Comparing rigid boundary condition and pressure release boundary condition for modeling ultrasound transducers 
---
<p>
<br>
<hr>
<hr>
This example illustrates the difference between the rigid boundary condition (baffled source) and pressure release boundary condition for modeling
ultrasound transducers. Currently, mSOUND uses the pressure release boundary condition, in which the planar transducer surface is assigned with a certain pressure distribution
and the pressure is zero everywhere else on the input plane. When modeling a baffled source, where the rigid boundary condition is assumed, the transducer is assigned with
a certain particle velocity distribution and the particle velocity in the normal direction is zero everywhere else. These two boundary conditions normally would produce different results 
mainly in the near-field, but the difference becomes less significant in the far-field. In this example, we use mSOUND to model a planar transducer with the pressure release boundary condition.
We also use mSOUND to model the same transducer with the rigid boundary condition. In this case, the input plane pressure is obtained from FOCUS. 
The flat transducer has a diameter of 20 mm.
<hr>
<hr>
</p>

<!---defining the structure grid--->
<h6>Generating the grid structure to define the computational domain</h6>
<hr>
<p>
<br>
<!--This simulation setup is based on the 
<a href="https://m-sound.github.io/mSOUND/TMDM_3D_homogeneous">
Simulation of a 3D homogeneous medium using the transient mixed domain method</a>.
The phase delay for each element in the transducer are the same in the two cases. -->
We first need to define the temporal and spatial computational domains in 3D forward simulations. 
In FSMDM, any arbitrary values can be set for the time step and temporal domain size, since they are not being used. 
Here, we set them to 0. We also define the background acoustic medium in this section. 
 <pre>
<code>      

medium.c0 = 1500;      <font color="#03a852"> % speed of Sound [m/s]</font> 
medium.rho0 = 1000;    <font color="#03a852"> % density of medium [kg/m^3]</font> 
medium.ca0 = 0;        <font color="#03a852"> % attenuation coefficient [dB/(MHz^y cm)]; 1 dB/cm at 500 kHz</font>  
medium.cb0 = 2.0;      <font color="#03a852"> % power law exponent</font>   

dx = lambda/6;  <font color="#03a852"> % step size in the x direction [m]</font> 
dy = lambda/6;  <font color="#03a852"> % step size in the y direction [m]</font> 
dz = lambda/6;  <font color="#03a852"> % step size in the z direction [m]</font> 

x_length = 70e-3*4+dx;    <font color="#03a852"> % computational domain size in the x direction [m]</font> 
y_length = 70e-3*4+dx;    <font color="#03a852"> % computational domain size in the y direction [m]</font> 
z_length = 120e-3-19*dz;  <font color="#03a852"> % computational domain size in the z direction [m]</font> 
    
mgrid = set_grid(0, 0, dx, x_length, dy, y_length, dz, z_length);              
</code>   
</pre>
</p>


<!---Excitation signal--->
<h6>Excitation signal</h6>
<hr>
<p>
We assume pressure release boundary in the first simulation. In the 2nd simulation, the input plane pressure is generated by FOCUS, which uses the rigid boundary condition. The corresponding FOCUS code 
 (input_plane_FOCUS_unfocused_transducer_code.m) can be found in the example folder.
 <br>
 <pre>
<code>  
<font color="#03a852"> % set up pressure release boundary condition </font> 
source_p = p0*ones(mgrid.num_x,mgrid.num_y);   
<font color="#03a852"> % set the pressure to be zero outside the source surface </font> 
source_p(RHO>TR_radius) = 0; 

<font color="#03a852"> % load FOCUS input plane pressure </font> 
load FOCUS_input_plane_unfocused_lossless_0.5mm.mat
source_p1 = p_amp.*exp(1i*p_phase);

</code>
</pre>
 </p>


<p>
<h6>Defining the medium properties</h6>
<hr>
Define the homogeneous medium. It is the same as the background medium. 
 <pre>
 <code>
medium.c    = medium.c0;     <font color="#03a852">% speed of sound [m/s]</font>   
medium.rho  = medium.rho0;   <font color="#03a852">% density [kg/m^3]</font>                
medium.ca   = medium.ca0;    <font color="#03a852">% attenuation coefficient [dB/(MHz^y cm)] </font>    
medium.cb   = medium.cb0;    <font color="#03a852">% power law exponent</font>  

<font color="#03a852">% setting the non-reflecting boundary layer </font>   
medium.NRL_gamma = 0.1;  
medium.NRL_alpha = 0.02; 
</code>
</pre>
</p>


<!---3D forward Simulation--->
<h6>3D forward simulation</h6>
<hr>
<p>
 The pressure field is calculated with the 3D forward simulation function 
 <a href="/mSOUND/function.html#Forward3D_fund">Forward3D_fund</a>. 
 
<pre> <code>
fc = 0.5e6;        <font color="#03a852">% ultrasound frequency/ Hz</font>   
omega_c = 2*pi*fc; <font color="#03a852">% angular frequency</font>   
<font color="#03a852">% forward propagation of the wave at the fundamental frequency 
%for the two boundary conditions </font>   
[P_fundamental] = Forward3D_fund(mgrid, medium, source_p, omegac, 0 ,[],'NRL');
[P_fundamental1] = Forward3D_fund(mgrid, medium, source_p1, omegac, 0 ,[],'NRL');
</code>
</pre>
</p>

The two figures below show the pressure field distribution along the axial direction and transverse direction (at 60 mm depth). The results obtained from FOCUS alone (blue line) 
are also shown for comparison. As expected, the difference between the two different boundary conditions mainly exist in the near field. This difference must be considered when 
comparing mSOUND with other solvers.
<img src="/mSOUND/img/rigidvsrelease_axial.jpg" alt="Axial pressure field of the flat transducer">
<img src="/mSOUND/img/rigidvsrelease_transverse.jpg" alt="Transverse pressure field of the flat transducer">




<h6>Other examples</h6>
<hr>
<p>
<br> <h7 style='font-weight:bold;'>&#11166;Forward TMDM</h7>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/TMDM_2D_homogeneous">
    Simulation of a 2D homogeneous medium using the transient mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/TMDM_2D_heterogeneous">
    Simulation of a 2D heterogeneous medium using the transient mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/TMDM-2D-strong-speed-of-sound-contrast">
    Simulation of a strongly 2D heterogeneous medium using the transient mixed domain method</a>  
<br>&middot;<a href="https://m-sound.github.io/mSOUND/TMDM_3D_homogeneous">
    Simulation of a 3D homogeneous medium using the transient mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/TMDM_2D_animation">
    Selecting the proper temporal domain size for the TMDM</a>  
<br>&middot;<a href="https://m-sound.github.io/mSOUND/TMDM_shock">
    Shock wave simulations with TMDM</a>   
 
<br><h7 style='font-weight:bold;'>&#11166;Forward FSMDM</h7>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/FSMDM_2D_homogeneous">
    Simulation of a 2D homogeneous medium using the frequency-specific mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/FSMDM_2D_heterogeneous">
    Simulation of a 2D heterogeneous medium using the frequency-specific mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/FSMDM_3D_homogeneous">
    Simulation of a 3D homogeneous medium using the frequency-specific mixed domain method</a>
<br>&middot;<a href="https://m-sound.github.io/mSOUND/FSMDM-3D_heterogeneous">
    Simulation of a 3D heterogeneous medium using the frequency-specific mixed domain method</a>
 <br>&middot;<a href="https://m-sound.github.io/mSOUND/2D_absorption">
    Reducing the spatial aliasing error using the non-reflecting layer</a>
 <br>&middot;<a href="https://m-sound.github.io/mSOUND/rigid_vs_pressure_release">
    Comparing pressure release and rigid boundary conditions</a>

 <br><h7 style='font-weight:bold;'>&#11166;Backward Propagation</h7>
 <br>&middot;<a href="https://m-sound.github.io/mSOUND/Backward_TMDM">
    Image reconstruction using backward projection</a>    
 <br>&middot;<a href="https://m-sound.github.io/mSOUND/FSMDM_3D_multi_sources">
    Reconstruction of the source pressure distribution with FSMDM in a 3D homogeneous medium</a>
 
 <br><h7 style='font-weight:bold;'>&#11166;Integration with Other Simulators</h7>
 <br>&middot;<a href="https://m-sound.github.io/mSOUND/combine-k-Wave-TMDM">
    Integrating mSOUND with k-Wave for transducers of arbitrary shape</a>
 <br>&middot;<a href="https://m-sound.github.io/mSOUND/combine-FOCUS-mSOUND">
    Integrating mSOUND with FOCUS for transducers of arbitrary shape</a> 
 <br>&middot;<a href="https://m-sound.github.io/mSOUND/combine-k-Wave-diffusion">
    Integrating mSOUND with k-Wave for thermal simulations</a> 
</p>


